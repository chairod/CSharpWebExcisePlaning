using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace ExcisePlaning.Classes
{
    /// <summary>
    /// ตรวจสอบรูปแบบการโจมตีเว็บไซด์ ที่เข้ามาจาก Http
    /// </summary>
    public class VerifyVulnerability
    {
        /// <summary>
        /// ตอบข้อความกลับไปยัง Client ที่ต้องขอเป็น 400 (Bad Request)
        /// </summary>
        /// <param name="httpContext"></param>
        public static void ThrowBadRequest(HttpContextBase httpContext)
        {
            httpContext.Response.StatusCode = 400;
            httpContext.Response.Headers.Add("Content-Type", "text/html; UTF-8");
            httpContext.Response.Output.Flush();
            httpContext.Response.Output.WriteLine("<h1>Bad Request</h1>");
            httpContext.Response.End();
        }


        /// <summary>
        /// การโจมตีเว็บไซด์ โดยการใช้ ../ (Path Traversal) เพื่อขอดาวน์โหลดไฟล์ต่างๆ
        /// ใน Server ผ่านจุดออ่นของ Source Code ที่ไม่ป้องกันไว้
        /// </summary>
        /// <param name="reqValue"></param>
        /// <returns></returns>
        public static bool VerifyPathTraversal(string reqValue)
        {
            if (string.IsNullOrEmpty(reqValue))
                return true;
            reqValue = HttpUtility.UrlDecode(reqValue);
            return !(reqValue.Contains("../") || reqValue.Contains(@"..\"));
        }
    }
}